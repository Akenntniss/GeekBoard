<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Commande - zebilamcj.servo.tools</title>
    <script>
        // Test simple pour v√©rifier si le modal fonctionne
        function testModalCommande() {
            console.log('=== TEST MODAL COMMANDE ===');
            
            // Simuler la collecte de pi√®ces multiples
            const pieces = [
                {
                    nom_piece: "√âcran LCD",
                    code_barre: "LCD001",
                    quantite: 1,
                    prix_estime: 120.50
                },
                {
                    nom_piece: "Batterie",
                    code_barre: "BAT002", 
                    quantite: 2,
                    prix_estime: 45.00
                }
            ];
            
            const informationsCommunes = {
                client_id: "123",
                fournisseur_id: "456",
                statut: "en_attente",
                reparation_id: null
            };
            
            console.log('Pi√®ces √† soumettre:', pieces);
            console.log('Informations communes:', informationsCommunes);
            
            // Simuler l'envoi de chaque pi√®ce
            pieces.forEach((piece, index) => {
                console.log(`Envoi pi√®ce ${index + 1}:`, piece);
                
                // Simuler l'appel AJAX
                const formData = new FormData();
                formData.append('client_id', informationsCommunes.client_id);
                formData.append('fournisseur_id', informationsCommunes.fournisseur_id);
                formData.append('statut', informationsCommunes.statut);
                formData.append('nom_piece', piece.nom_piece);
                formData.append('code_barre', piece.code_barre);
                formData.append('quantite', piece.quantite);
                formData.append('prix_estime', piece.prix_estime);
                
                // Log des donn√©es qui seraient envoy√©es
                const dataToSend = {};
                for (let [key, value] of formData.entries()) {
                    dataToSend[key] = value;
                }
                console.log(`Donn√©es FormData pi√®ce ${index + 1}:`, dataToSend);
            });
            
            console.log('=== FIN TEST ===');
        }
        
        // Tester au chargement de la page
        window.onload = function() {
            console.log('Page charg√©e - Lancement du test...');
            testModalCommande();
        };
    </script>
</head>
<body>
    <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h1>Test Modal Commande</h1>
        <p>Ouvrez la console de d√©veloppement (F12) pour voir les logs de test.</p>
        <button onclick="testModalCommande()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Relancer le test
        </button>
        
        <h2>Instructions de test :</h2>
        <ol>
            <li>Allez sur <strong>zebilamcj.servo.tools</strong></li>
            <li>Ouvrez la console de d√©veloppement (F12)</li>
            <li>Ouvrez le modal "Nouvelle commande de pi√®ces"</li>
            <li>V√©rifiez si vous voyez le message : <code>üõí [MODAL-COMMANDE] Initialisation du modal de commande v2.0</code></li>
            <li>Ajoutez 2 pi√®ces avec le bouton "Ajouter une autre pi√®ce"</li>
            <li>Remplissez les champs et cliquez "Enregistrer"</li>
            <li>V√©rifiez les logs dans la console</li>
        </ol>
        
        <h2>Que v√©rifier dans les logs :</h2>
        <ul>
            <li>‚úÖ Message d'initialisation v2.0</li>
            <li>‚úÖ "Pi√®ces collect√©es: [...]" avec le bon nombre de pi√®ces</li>
            <li>‚úÖ "Appel soumettreCommandesMultiples avec:" avec les bonnes donn√©es</li>
            <li>‚úÖ Messages "‚úÖ Commande 1/X ajout√©e avec succ√®s"</li>
            <li>‚úÖ "X commande(s) ajout√©e(s) avec succ√®s !"</li>
        </ul>
    </div>
</body>
</html>
