<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bouton Recherche - GeekBoard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">üîç Test du Bouton de Recherche</h1>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Diagnostic du Probl√®me</h5>
                    </div>
                    <div class="card-body">
                        <!-- Bouton pour ouvrir le modal -->
                        <button class="btn btn-primary btn-lg w-100 mb-3" type="button" data-bs-toggle="modal" data-bs-target="#rechercheModal">
                            <i class="fas fa-search me-2"></i>Ouvrir Modal de Recherche
                        </button>
                        
                        <!-- Zone de test -->
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Instructions de test :</h6>
                            <ol>
                                <li>Cliquez sur le bouton ci-dessus pour ouvrir le modal</li>
                                <li>Tapez au moins 2 caract√®res dans le champ de recherche</li>
                                <li>Cliquez sur le bouton "Rechercher"</li>
                                <li>V√©rifiez la console du navigateur (F12) pour les erreurs</li>
                            </ol>
                        </div>
                        
                        <!-- Log des √©v√©nements -->
                        <div class="mt-4">
                            <h6>Log des √©v√©nements :</h6>
                            <div id="eventLog" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;">
                                <small class="text-muted">Les √©v√©nements appara√Ætront ici...</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de recherche (copie du modal universel) -->
    <div class="modal fade" id="rechercheModal" tabindex="-1" aria-labelledby="rechercheModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <!-- Header -->
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="rechercheModalLabel">
                        <i class="fas fa-search me-2"></i>
                        Recherche Universelle - TEST
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                
                <!-- Body -->
                <div class="modal-body">
                    <!-- Zone de recherche -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <input type="text" class="form-control form-control-lg" id="rechercheInput" 
                                   placeholder="Rechercher par nom, t√©l√©phone, appareil...">
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-primary btn-lg w-100" id="rechercheBtn">
                                <i class="fas fa-search me-2"></i>Rechercher
                            </button>
                        </div>
                    </div>
                    
                    <!-- Zone de r√©sultats -->
                    <div id="rechercheResults" class="mt-4" style="display: none;">
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle me-2"></i>Test r√©ussi !</h6>
                            <p class="mb-0">Le bouton de recherche fonctionne correctement.</p>
                        </div>
                    </div>
                    
                    <!-- Zone d'erreur -->
                    <div id="rechercheError" class="mt-4" style="display: none;">
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Erreur d√©tect√©e !</h6>
                            <p id="errorMessage" class="mb-0"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Fonction pour logger les √©v√©nements
        function logEvent(message, type = 'info') {
            const log = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            
            log.innerHTML += `<div class="${color}"><strong>[${timestamp}]</strong> ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        document.addEventListener('DOMContentLoaded', function() {
            logEvent('‚úÖ Page charg√©e, initialisation du test...');
            
            // √âl√©ments du modal
            const modal = document.getElementById('rechercheModal');
            const input = document.getElementById('rechercheInput');
            const btn = document.getElementById('rechercheBtn');
            const results = document.getElementById('rechercheResults');
            const error = document.getElementById('rechercheError');
            const errorMessage = document.getElementById('errorMessage');
            
            // V√©rifier que les √©l√©ments existent
            logEvent(`Modal trouv√©: ${!!modal}`);
            logEvent(`Input trouv√©: ${!!input}`);
            logEvent(`Bouton trouv√©: ${!!btn}`);
            
            if (!modal || !input || !btn) {
                logEvent('‚ùå √âl√©ments critiques manquants !', 'error');
                return;
            }
            
            // √âv√©nement d'ouverture du modal
            modal.addEventListener('shown.bs.modal', function() {
                logEvent('üìÇ Modal ouvert avec succ√®s');
                input.focus();
            });
            
            // √âv√©nement sur le bouton de recherche
            btn.addEventListener('click', function() {
                logEvent('üîç Clic sur le bouton de recherche d√©tect√©');
                
                const searchTerm = input.value.trim();
                logEvent(`Terme de recherche: "${searchTerm}"`);
                
                if (searchTerm.length < 2) {
                    logEvent('‚ö†Ô∏è Terme trop court (moins de 2 caract√®res)', 'error');
                    errorMessage.textContent = 'Veuillez saisir au moins 2 caract√®res';
                    error.style.display = 'block';
                    results.style.display = 'none';
                    return;
                }
                
                // Simuler une recherche r√©ussie
                logEvent('‚úÖ Recherche simul√©e avec succ√®s', 'success');
                error.style.display = 'none';
                results.style.display = 'block';
                
                // Test AJAX (optionnel)
                testAjaxCall(searchTerm);
            });
            
            // √âv√©nement sur la touche Entr√©e
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    logEvent('‚å®Ô∏è Touche Entr√©e press√©e');
                    btn.click();
                }
            });
            
            logEvent('üéØ Tous les √©v√©nements configur√©s avec succ√®s', 'success');
        });
        
        // Test de l'appel AJAX
        function testAjaxCall(searchTerm) {
            logEvent('üåê Test de l\'appel AJAX...');
            
            fetch('ajax/recherche_universelle.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `terme=${encodeURIComponent(searchTerm)}`
            })
            .then(response => {
                logEvent(`üì° R√©ponse AJAX re√ßue (Status: ${response.status})`);
                return response.json();
            })
            .then(data => {
                logEvent('‚úÖ Donn√©es JSON pars√©es avec succ√®s', 'success');
                logEvent(`R√©sultats: ${JSON.stringify(data).substring(0, 100)}...`);
            })
            .catch(error => {
                logEvent(`‚ùå Erreur AJAX: ${error.message}`, 'error');
            });
        }
        
        // Capturer les erreurs JavaScript globales
        window.addEventListener('error', function(e) {
            logEvent(`‚ùå Erreur JavaScript: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });
        
        // Capturer les erreurs de promesses non g√©r√©es
        window.addEventListener('unhandledrejection', function(e) {
            logEvent(`‚ùå Promesse rejet√©e: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>