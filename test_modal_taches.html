<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Tâches</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>Test du Modal des Tâches</h2>
        
        <!-- Simulation du tableau moderne -->
        <div class="modern-table">
            <div class="modern-table-row" data-task-id="123" onclick="afficherDetailsTache(event, 123)">
                <div class="modern-table-cell primary">
                    <span class="modern-table-text">Tâche de test</span>
                </div>
                <div class="modern-table-cell">
                    <span class="modern-badge bg-danger">Haute</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour afficher les détails d'une tâche -->
    <div class="modal fade" id="taskDetailsModal" tabindex="-1" aria-labelledby="taskDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskDetailsModalLabel">Détails de la tâche</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body">
                    <div class="task-detail-container">
                        <div class="mb-3">
                            <h5 id="task-title" class="fw-bold"></h5>
                            <div class="mt-2">
                                <span class="me-2">Priorité:</span>
                                <span id="task-priority" class="fw-medium"></span>
                            </div>
                            <div class="mt-3">
                                <span class="me-2 fw-medium">Description:</span>
                                <p id="task-description" class="mt-2 p-2 rounded">Chargement...</p>
                            </div>
                            <div id="task-error-container" class="alert alert-danger mt-2" style="display:none;"></div>
                        </div>
                        
                        <div class="task-actions d-flex justify-content-between gap-2 mt-4">
                            <div class="d-flex gap-2">
                                <button id="start-task-btn" class="btn btn-primary" data-task-id="" data-status="en_cours">
                                    <i class="fas fa-play me-2"></i>Démarrer
                                </button>
                                <button id="complete-task-btn" class="btn btn-success" data-task-id="" data-status="termine">
                                    <i class="fas fa-check me-2"></i>Terminer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fonction pour afficher les détails d'une tâche
        function afficherDetailsTache(event, taskId) {
            console.log("Fonction afficherDetailsTache appelée avec taskId:", taskId);
            // Empêcher la propagation de l'événement
            event.stopPropagation();
            
            // Trouver l'élément de la tâche correspondante (moderne ou classique)
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            console.log("Élément de tâche trouvé:", taskElement);
            
            let title, priority;
            
            if (taskElement) {
                // Vérifier si c'est une structure moderne (div) ou classique (tr)
                if (taskElement.classList.contains('modern-table-row')) {
                    // Structure moderne avec divs
                    title = taskElement.querySelector('.modern-table-text').textContent.trim();
                    priority = taskElement.querySelector('.modern-badge').textContent.trim();
                } else {
                    // Structure classique avec tableau
                    const taskRow = taskElement.closest('tr');
                    if (taskRow) {
                        title = taskRow.querySelector('td:nth-child(1)').textContent.trim();
                        priority = taskRow.querySelector('td:nth-child(2) .badge').textContent.trim();
                    }
                }
                console.log("Informations de la tâche:", { title, priority });
                
                // Vérifier que nous avons les informations nécessaires
                if (!title || !priority) {
                    console.error("Impossible de récupérer les informations de la tâche");
                    return;
                }
                
                // Remplir le modal avec les informations de la tâche
                document.getElementById('task-title').textContent = title;
                document.getElementById('task-description').textContent = "Chargement...";
                document.getElementById('task-priority').textContent = priority;
                
                // Mettre à jour les attributs data-task-id des boutons
                document.getElementById('start-task-btn').setAttribute('data-task-id', taskId);
                document.getElementById('complete-task-btn').setAttribute('data-task-id', taskId);
                
                // Afficher le modal
                const taskModal = document.getElementById('taskDetailsModal');
                console.log("Modal trouvé:", taskModal);
                if (taskModal) {
                    const bsModal = new bootstrap.Modal(taskModal);
                    console.log("Modal Bootstrap créé:", bsModal);
                    bsModal.show();
                    console.log("Modal affiché");
                    
                    // Simuler le chargement des détails
                    setTimeout(() => {
                        document.getElementById('task-description').textContent = "Description de la tâche de test";
                    }, 1000);
                }
            } else {
                console.error("Élément de tâche non trouvé pour l'ID:", taskId);
            }
        }
    </script>

    <style>
        .modern-table-row {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .modern-table-row:hover {
            background-color: #f8f9fa;
        }
        
        .modern-table-cell {
            flex: 1;
            margin-right: 15px;
        }
        
        .modern-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .bg-danger {
            background-color: #dc3545 !important;
            color: white;
        }
    </style>
</body>
</html>
